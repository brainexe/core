<?xml version="1.0" encoding="utf-8"?>
<container xmlns="http://symfony.com/schema/dic/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
	<parameters>
		<parameter key="debug">false</parameter>
		<parameter key="cache.enabled">true</parameter>
		<parameter key="server.address">localhost:8080</parameter>

		<parameter key="timezone">Europe/Berlin</parameter>

		<parameter key="redis.host">127.0.0.1</parameter>
		<parameter key="redis.password"/>
		<parameter key="redis.database">0</parameter>

		<parameter key="cache.dir">%application.root%cache/</parameter>
		<parameter key="template.dir">%application.root%templates/</parameter>
		<parameter key="logger.dir">%application.root%logs/</parameter>
		<parameter key="logger.error.log">%logger.dir%error.log</parameter>
		<parameter key="logger.info.log">%logger.dir%info.log</parameter>

		<parameter key="application.name" on-invalid="exception"/>
		<parameter key="application.layout_template">layout.html.twig</parameter>
		<parameter key="application.error_template">error.html.twig</parameter>
		<parameter key="application.guests_allowed">false</parameter>
		<parameter key="application.registration_enabled">true</parameter>

		<parameter key="yui.jar">/usr/share/yui-compressor/yui-compressor.jar</parameter>

		<parameter key="assets.priorities" type="collection"/>
		<parameter key="assets.mergable" type="collection">
			<parameter>js</parameter>
			<parameter>css</parameter>
		</parameter>
		<parameter key="assets.separate" type="collection">
		</parameter>
	</parameters>

    <services>
		<service id="twig" class="Matze\Core\Twig\TwigEnvironment" public="false">
			<argument type="service">
				<service class="Twig_Loader_Chain">
					<argument type="collection">
						<argument type="service">
							<service class="Twig_Loader_Filesystem">
								<argument>%template.dir%</argument>
							</service>
						</argument>
						<argument type="service">
							<service class="Twig_Loader_Filesystem">
								<argument>%application.vendor_root%core/templates</argument>
							</service>
						</argument>
					</argument>
				</service>
			</argument>
			<argument type="collection">
				<argument key="cache">%cache.dir%twig</argument>
				<argument key="debug">%debug%</argument>
				<argument key="auto_reload">%debug%</argument>
			</argument>
		</service>

		<service id="TwigCompiler" parent="twig" public="false"/>

        <service id="redis" class="Redis" public="false">
			<call method="connect">
				<argument key="host">%redis.host%</argument>
			</call>
        </service>

		<service id="monolog.ErrorHandler" class="Monolog\ErrorHandler">
			<argument type="service" id="Monolog.Logger"/>
			<call method="registerErrorHandler"/>
			<call method="registerExceptionHandler"/>
			<call method="registerFatalHandler"/>
		</service>

        <service id="monolog.logger" class="Monolog\Logger">
            <argument>%application.name%</argument>
			<call method="pushHandler">
				<argument type="service">
					<service class="Matze\Core\Logger\ChannelStreamHandler">
						<argument>%logger.error.log%</argument>
						<argument type="constant">Monolog\Logger::ERROR</argument>
					</service>
				</argument>
			</call>
			<call method="pushHandler">
				<argument type="service">
					<service class="Matze\Core\Logger\ChannelStreamHandler">
						<argument>%logger.info.log%</argument>
						<argument type="constant">Monolog\Logger::INFO</argument>
					</service>
				</argument>
			</call>
			<call method="pushHandler">
				<argument type="service">
					<service class="Matze\Core\Logger\ChannelStreamHandler">
						<argument>%logger.dir%gentime.log</argument>
						<argument type="constant">Monolog\Logger::DEBUG</argument>
						<argument>gentime</argument>
					</service>
				</argument>
			</call>
        </service>
		<service id="EventDispatcher" class="Symfony\Component\EventDispatcher\EventDispatcher" public="false">
		</service>

		<service id="Console" class="Symfony\Component\Console\Application"/>

		<service id="RedisSession" class="Symfony\Component\HttpFoundation\Session\Session" public="false">
			<argument type="service">
				<service class="Symfony\Component\HttpFoundation\Session\Storage\NativeSessionStorage">
					<argument type="collection">
						<argument key="cookie_httponly">true</argument>
						<argument key="cookie_lifetime">30758400</argument>
						<argument key="name">sid_%application.name%</argument>
					</argument>

					<argument type="service" id="RedisSessionHandler"/>
				</service>
			</argument>
		</service>

		<!--TODO-->
		<service id="service_container" class="Symfony\Component\DependencyInjection\Container"/>

		<service id="cache.redis" class="Matze\Core\Application\Cache\RedisCache" public="false">
			<argument type="service" id="redis"/>
		</service>
		<service id="cache" alias="cache.redis" public="false" />

		<service id="Assetic" class="Matze\Core\Assets\AssetManager" public="false"/>

		<service id="RouteCollection" class="Symfony\Component\Routing\RouteCollection" public="false"/>
		<service id="UrlGenerator" class="Symfony\Component\Routing\Generator\UrlGenerator" public="false">
			<argument type="service" id="RouteCollection"/>
			<argument type="service">
				<service class="Symfony\Component\Routing\RequestContext"/>
			</argument>
		</service>
	</services>
</container>
